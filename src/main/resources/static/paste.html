<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>文本共享</title>
    <script src="/lib/js/vue.global.js"></script>
    <script src="/lib/js/vue-router.global.min.js"></script>
    <script src="/lib/js/axios.min.js"></script>
    <script src="/lib/js/qs.min.js"></script>
    <script src="/lib/js/bootstrap.bundle.min.js"></script>
    <script src="/lib/js/js.cookie.min.js"></script>
    <script src="/lib/js/clipboard.min.js"></script>
    <link href="/lib/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/lib/css/bootstrap-icons.css" rel="stylesheet" />
    <link href="/css/common.css" rel="stylesheet" />
    <link href="/css/paste.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container">
      <div class="header">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" href="/">文件列表</a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="/p"
              :class="{active: ($route.name == 'pasteList' || $route.name == 'pasteDetail')}"
              >文本共享</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/task.html">任务列表</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/bookmark.html">书签列表</a>
          </li>
        </ul>
      </div>
      <router-view></router-view>
      <template id="pasteList">
        <div id="add">
          <input
            class="form-control"
            placeholder="标题"
            v-model="title"
            ref="title"
          />
          <textarea
            class="form-control"
            rows="10"
            placeholder="正文"
            v-model="text"
            ref="text"
          ></textarea>
          <button class="btn btn-outline-primary float-end" @click="add()">
            发布
          </button>
        </div>
        <div id="list">
          <ul class="list-group">
            <li
              class="list-group-item list-group-item-action"
              v-for="paste in pastes"
              style="cursor: pointer"
              @click="(event) => event.target.tagName !== 'A' && event.target.tagName !== 'I' && $router.push('/p/' + paste.id)"
            >
              <div class="float-end">
                <a
                  class="link-primary"
                  id="btnCopy"
                  :data-clipboard-text="paste.text"
                  ><i class="bi bi-clipboard"></i
                ></a>
                <a
                  class="link-danger"
                  @click="$root.showConfirm(() => $root.del(paste.id))"
                  ><i class="bi bi-trash"></i
                ></a>
              </div>
              <div>
                <p class="text-primary text-truncate" style="max-width: 60%">
                  {{paste.title}}
                </p>
                <p class="text-truncate" style="width: calc(80%)">
                  {{paste.text}}
                </p>
                <p class="text-muted mb-0">
                  发布于 {{paste.time.slice(0, -3)}}
                </p>
              </div>
            </li>
          </ul>
        </div>
      </template>
      <template id="pasteDetail">
        <div class="card">
          <div class="card-body border-bottom">
            <div
              class="d-flex justify-content-between flex-wrap align-items-center"
            >
              <a
                class="link-primary text-decoration-none"
                @click="$router.push('/p')"
                >返回</a
              >
              <div class="text-muted text-truncate" style="max-width: 30%">
                {{title}}
              </div>
              <div>
                <a
                  class="btn btn-outline-primary btn-sm"
                  id="btnCopy"
                  data-clipboard-target="#textarea"
                  >复制</a
                >
                <a class="btn btn-outline-primary btn-sm" @click="update()"
                  >提交修改</a
                >
                <a
                  class="btn btn-outline-danger btn-sm"
                  @click="$root.showConfirm(() => $root.del($route.params.id))"
                  >删除</a
                >
              </div>
            </div>
          </div>
          <textarea
            class="form-control border-0"
            v-model="text"
            ref="text"
            id="textarea"
          ></textarea>
        </div>
      </template>
      <template id="shareList">
        <table class="table">
          <tr>
            <th>分享码</th>
            <th>文件路径</th>
            <th>操作</th>
          </tr>
          <tr
            v-for="shareCode in shareCodeList"
            :class="{'text-danger': !shareCode.valid}"
          >
            <td>{{shareCode.code}}</td>
            <td>{{shareCode.path}}</td>
            <td>
              <a class="link-primary" @click="visit(shareCode.code)">访问</a
              >&nbsp;
              <a class="link-danger" @click="del(shareCode.code)">删除</a>
            </td>
          </tr>
        </table>
      </template>
      <template id="shareDetail">
        <div class="card">
          <div class="card-header">文件分享</div>
          <div class="card-body text-center">
            <p>
              文件名：{{file.name}}<br />
              文件大小：{{$root.formatBytes(file.length)}}<br />
              修改时间：{{file.lastModified}}<br />
              文件类型：{{file.fileType}}<br />
            </p>
            <button
              class="btn btn-sm btn-outline-primary"
              @click="download(file.relativePath)"
            >
              下载
            </button>
          </div>
        </div>
      </template>
    </div>
    <div class="modal" tabindex="-1" ref="messageModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">{{message.title}}</h5>
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p style="white-space: pre-wrap">{{message.text}}</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-primary" data-bs-dismiss="modal">
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" tabindex="-1" ref="confirmModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">删除</h5>
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>确定要删除吗？</p>
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-outline-danger"
              data-bs-dismiss="modal"
              @click="confirmDelete()"
            >
              确定
            </button>
            <button class="btn btn-outline-primary" data-bs-dismiss="modal">
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" tabindex="-1" ref="authModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">验证</h5>
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <label for="password" class="form-label">请输入密码</label>
            <input
              type="password"
              class="form-control"
              id="password"
              ref="password"
              @keyup.enter="$refs.btnAuth.click()"
            />
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-outline-primary"
              data-bs-dismiss="modal"
              @click="getToken()"
              ref="btnAuth"
            >
              确定
            </button>
            <button class="btn btn-outline-primary" data-bs-dismiss="modal">
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>
    <div v-show="loading" class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <script src="/js/paste.js"></script>
  </body>
</html>

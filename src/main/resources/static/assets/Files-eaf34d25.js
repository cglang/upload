import{_ as T,a as h,l as m,c,b as s,F as b,r as w,d,w as g,v as x,e as P,o as a,n as v,t as f,f as C,g as M,h as D}from"./index-724d87ef.js";import"./FileSaver.min-dca54424.js";let p;const F=h.CancelToken,$={data(){return{currentDirectory:"/",directories:[],files:[],filter:"",multiSelect:!1,checkedFiles:[],cutFiles:[],columns:["size","lastModified"]}},methods:{list(){this.$root.loading=!0,this.files=[],this.checkedFiles=[],p!==void 0&&p(),h.post("file/list",m.stringify({currentDirectory:this.currentDirectory}),{cancelToken:new F(function(e){p=e})}).then(o=>{if(o.success)this.files=o.detail;else{if(o.msg==="没有权限"&&!this.$root.hasToken(()=>this.list()))return;this.$root.showModal("失败",o.msg)}}).catch(o=>{this.$root.showModal("错误",o.message)}).finally(()=>{this.$root.loading=!1})},search(){if(this.filter.trim().length===0){this.list();return}this.$root.loading=!0,this.files=[],this.checkedFiles=[],p!==void 0&&p(),h.post("file/search",m.stringify({filter:this.filter,currentDirectory:this.currentDirectory}),{cancelToken:new F(function(e){p=e})}).then(o=>{o.success?this.files=o.detail:this.$root.showModal("失败",o.msg)}).catch(o=>{o.name!=="CanceledError"&&this.$root.showModal("错误",o.message)}).finally(()=>{this.$root.loading=!1})},changeDirectory(o){this.currentDirectory=o,this.list(),this.getDirectoryHierachy()},getDirectoryHierachy(){this.directories=[];const o=this.currentDirectory.split("/"),e=[];for(let n=0;n<o.length;n++){e.push(o[n]);const u=e.join("/");this.directories.push({displayName:o[n],relativePath:u.length===0?"/":u})}this.directories[0].displayName="Home"},getParentDirectory(o){let e=o.split("/");e.pop();let n=e.join("/");return n.length===0?"/":n},upload(o){if(!this.$root.hasToken(()=>this.upload(o)))return;this.$root.message.title="上传进度";const e=new Modal(this.$root.$refs.progressModal);e.show();const n=new FormData;n.append("currentDirectory",this.currentDirectory),Array.from(o.target.files).forEach(t=>{console.log(t),n.append("files",t)}),h({method:"post",url:"file/upload",data:n,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t=>{const l=t.loaded,i=t.total;this.$root.progress=Math.round(l/i*100)+"%"}}).then(t=>{t.success?(e.hide(),this.list(),this.$root.showModal("成功","上传成功"),this.$root.progress=0):(e.hide(),this.$root.showModal("失败",t.msg),this.$root.progress=0)}).catch(t=>{e.hide(),this.$root.showModal("错误",t.message),this.$root.progress=0})},createDirectory(){const o=this.$root.$refs.input.value;if(o.trim().length===0){this.$root.showModal("提示","文件夹名不能为空");return}this.$root.hasToken(()=>this.createDirectory())&&(this.$root.loading=!0,h.post("file/mkdir",m.stringify({relativePath:this.currentDirectory+"/"+o})).then(e=>{e.success?(this.list(),this.$root.showModal("成功","新建文件夹成功")):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1}))},download(o){this.$root.message.title="正在下载";const e=new Modal(this.$root.$refs.progressModal);e.show();var n=new Date().getTime(),u=0;h({method:"post",url:h.defaults.baseURL+"file/download",data:m.stringify({relativePath:o}),responseType:"blob",onDownloadProgress:t=>{const l=t.loaded,i=t.total;this.$root.progress=Math.round(l*100/i)+"%";var r=new Date().getTime(),y=l-u,k=(r-n)/1e3,_=k?y/k:0;u=l,n=r,this.$root.speed=this.$root.formatBytes(_)+"/s"}}).then(t=>{let l=t.headers["content-disposition"].split("filename=")[1];l=decodeURIComponent(l),saveAs(t.data,l)}).catch(t=>{e.hide(),this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.progress=0,e.hide()})},downloadFolder(o){this.$root.message.title="正在下载";const e=new Modal(this.$root.$refs.progressModal);e.show();var n=new Date().getTime(),u=0;h({method:"post",url:h.defaults.baseURL+"file/zip",data:m.stringify({relativePath:o}),responseType:"blob",onDownloadProgress:t=>{const l=t.loaded,i=t.total;this.$root.progress=Math.round(l*100/i)+"%";var r=new Date().getTime(),y=l-u,k=(r-n)/1e3,_=k?y/k:0;u=l,n=r,this.$root.speed=this.$root.formatBytes(_)+"/s"}}).then(t=>{let l=t.headers["content-disposition"].split("filename=")[1];l=decodeURIComponent(l),saveAs(t.data,l)}).catch(t=>{e.hide(),this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.progress=0,e.hide()})},bulkDownload(){location.href=h.defaults.baseURL+"file/bulk?relativePath="+encodeURIComponent(JSON.stringify(this.checkedFiles))},deleteFile(o){this.$root.hasToken(()=>this.deleteFile(o))&&(this.$root.loading=!0,h.post("file/delete",m.stringify({relativePath:JSON.stringify(o)})).then(e=>{e.success?(this.filter.length===0?this.list():this.search(this.filter),this.$root.showModal("成功","删除成功")):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1}))},rename(o){const e=this.$root.$refs.input.value;if(e.trim().length===0){this.$root.showModal("提示","新文件名不能为空");return}this.$root.hasToken(()=>this.rename(o))&&(this.$root.loading=!0,h.post("file/rename",m.stringify({src:o,dst:this.currentDirectory+"/"+e})).then(n=>{n.success?(this.$root.showModal("成功",n.msg),this.list()):this.$root.showModal("失败",n.msg)}).catch(n=>{this.$root.showModal("错误",n.message)}).finally(()=>{this.$root.loading=!1}))},cut(o){this.cutFiles=o,this.$root.showModal("剪切成功",this.cutFiles.join(`
`))},paste(){this.cutFiles.length!==0&&this.$root.hasToken(()=>this.paste())&&(this.$root.loading=!0,h.post("file/move",m.stringify({src:JSON.stringify(this.cutFiles),dst:this.currentDirectory})).then(o=>{o.success?(this.$root.showModal("成功",o.msg),this.cutFiles=[],this.list()):(this.$root.showModal("失败",o.msg),this.cutFiles=[])}).catch(o=>{this.$root.showModal("错误",o.message),this.cutFiles=[]}).finally(()=>{this.$root.loading=!1}))},preview(o,e){if(o.includes("image")){let n=document.getElementById("image");n.removeAttribute("src"),n.setAttribute("src",h.defaults.baseURL+"file/download?relativePath="+encodeURIComponent(e)),new Modal(this.$root.$refs.imageModal).show()}else o.includes("text")&&(this.$root.loading=!0,this.$root.message.title=e,this.$root.message.text="",h.post("file/read",m.stringify({relativePath:e})).then(n=>{n.success?(this.$root.message.text=n.detail,new Modal(this.$root.$refs.textModal).show()):this.$root.showModal("失败",n.msg)}).catch(n=>{this.$root.showModal("错误",n.message)}).finally(()=>{this.$root.loading=!1}))},share(o){this.$root.loading=!0,h.post("shareCode/add",m.stringify({path:o})).then(e=>{e.success?this.$root.showModal("分享成功",location.protocol+"//"+location.host+"/files/"+e.detail):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1})},checkAll(o){o.target.checked?(this.files.folders.forEach(e=>{this.checkedFiles.push(e.relativePath)}),this.files.files.forEach(e=>{this.checkedFiles.push(e.relativePath)})):this.checkedFiles=[]},hideColumn(o){this.columns.includes(o)?this.columns=this.columns.filter(e=>e!==o):this.columns.push(o)},getIcon(o,e){const n=o.split(".").pop(),u={"bi-file-earmark-binary":["exe"],"bi-file-earmark-zip":["zip","7z","rar"],"bi-file-earmark-code":["py","java","c","cpp","html","js","css"],"bi-file-earmark-pdf":["pdf"],"bi-file-earmark-word":["doc","docx"],"bi-file-earmark-excel":["xls","xlsx"],"bi-file-earmark-ppt":["ppt","pptx"]};for(const[i,r]of Object.entries(u))if(r.includes(n))return i;let l={text:"bi-file-earmark-text",image:"bi-file-earmark-image",audio:"bi-file-earmark-music",video:"bi-file-earmark-play"}[e.split("/")[0]];return l??" bi-file-earmark"}},mounted(){this.list(),this.getDirectoryHierachy()}},S={class:"card border-bottom-0"},z={class:"card-header"},I={class:"breadcrumb float-start",style:{margin:"0.5rem 0"}},B={key:0},N=["onClick"],U={class:"card-body"},E={id:"form",action:"upload",method:"post",enctype:"multipart/form-data"},j={class:"files-left"},R=s("button",{class:"btn btn-outline-primary",onclick:"document.getElementById('file').value=null; document.getElementById('file').click()"}," 上传文件 ",-1),A=s("button",{class:"btn btn-outline-primary ms-1",onclick:"document.getElementById('folder').value=null; document.getElementById('folder').click()"}," 上传文件夹 ",-1),O={class:"btn-group"},V=["disabled"],L=["disabled"],H=["disabled"],q=["disabled"],J={class:"files-right"},K={class:"w-100 d-flex"},W={class:"dropdown",style:{"padding-left":"5px"}},G=s("button",{class:"btn btn-outline-primary dropdown-toggle","data-bs-toggle":"dropdown","data-bs-auto-close":"outside"},[s("i",{class:"bi bi-grid-3x3-gap-fill"})],-1),Q={class:"dropdown-menu"},X={class:"dropdown-item"},Y={class:"form-check"},Z=["checked"],ee=s("label",{class:"form-check-label",for:"size"},"大小",-1),te={class:"dropdown-item"},se={class:"form-check"},oe=["checked"],ie=s("label",{class:"form-check-label",for:"contentType"},"类型",-1),le={class:"dropdown-item"},ne={class:"form-check"},re=["checked"],ce=s("label",{class:"form-check-label",for:"lastModified"},"修改日期",-1),ae={class:"mb-0 table table-hover"},de=["checked","indeterminate","disabled"],he=s("th",{class:"filename text-truncate"},"文件名",-1),ue={key:1,class:"size"},me={key:2,class:"contentType"},fe={key:3,class:"lastModified"},pe=s("th",{class:"action"},"操作",-1),ke={key:0},ge=s("a",{class:"link-primary"},"..",-1),ye=[ge],_e=["value"],be=["onClick"],we=s("i",{class:"bi bi-folder2"},null,-1),ve={class:"link-primary"},Ce={key:0,class:"size"},Me={key:1,class:"contentType"},De={key:2,class:"lastModified"},Fe={class:"action"},Te=["onClick"],xe=s("i",{class:"bi bi-cloud-download"},null,-1),Pe=[xe],$e=["onClick"],Se=s("i",{class:"bi bi-trash"},null,-1),ze=[Se],Ie={class:"dropdown d-inline"},Be=s("a",{class:"link-primary ms-1","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"bi bi-three-dots"})],-1),Ne={class:"dropdown-menu"},Ue=["onClick"],Ee=["onClick"],je=["value"],Re={class:"filename text-truncate"},Ae={key:0,class:"size"},Oe={key:1,class:"contentType"},Ve={key:2,class:"lastModified"},Le={class:"action"},He=["onClick"],qe=s("i",{class:"bi bi-cloud-download"},null,-1),Je=[qe],Ke=["onClick"],We=s("i",{class:"bi bi-trash"},null,-1),Ge=[We],Qe={class:"dropdown d-inline"},Xe=s("a",{class:"link-primary ms-1","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"bi bi-three-dots"})],-1),Ye={class:"dropdown-menu"},Ze=["onClick"],et=["onClick"],tt=["onClick"],st=["onClick"];function ot(o,e,n,u,t,l){return a(),c("div",S,[s("div",z,[s("ol",I,[(a(!0),c(b,null,w(t.directories,i=>(a(),c("li",{class:v(["filename text-truncate",["breadcrumb-item",{active:i.relativePath==t.currentDirectory}]]),key:i},[i.relativePath==t.currentDirectory?(a(),c("a",B,f(i.displayName),1)):(a(),c("a",{key:1,class:"link-primary",onClick:r=>l.changeDirectory(i.relativePath)},f(i.displayName),9,N))],2))),128))])]),s("div",U,[s("form",E,[s("input",{type:"file",name:"file",id:"file",class:"d-none",onChange:e[0]||(e[0]=i=>l.upload(i)),multiple:""},null,32),s("input",{type:"file",name:"folder",id:"folder",class:"d-none",onChange:e[1]||(e[1]=i=>l.upload(i)),multiple:"",webkitdirectory:""},null,32)]),s("div",j,[R,A,s("button",{class:"btn btn-outline-primary ms-1 me-1",onClick:e[2]||(e[2]=i=>o.$root.showInput("新建文件夹","输入文件夹名",l.createDirectory))}," 新建文件夹 "),s("button",{class:"btn btn-outline-primary me-1",onClick:e[3]||(e[3]=i=>l.list())}," 刷新 "),t.cutFiles.length!==0&&l.getParentDirectory(t.cutFiles[0])!==t.currentDirectory&&!t.currentDirectory.startsWith(t.cutFiles[0])?(a(),c("button",{key:0,class:"btn btn-outline-primary me-1",onClick:e[4]||(e[4]=i=>l.paste())}," 粘贴 ")):d("",!0),s("div",O,[s("button",{class:"btn btn-outline-primary",disabled:t.files.length===0,onClick:e[5]||(e[5]=i=>{t.multiSelect=!t.multiSelect,t.checkedFiles=[]})}," 多选 ",8,V),t.multiSelect?(a(),c("button",{key:0,disabled:t.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[6]||(e[6]=i=>l.bulkDownload())}," 下载 ",8,L)):d("",!0),t.multiSelect?(a(),c("button",{key:1,disabled:t.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[7]||(e[7]=i=>o.$root.showConfirm(function(){l.deleteFile(t.checkedFiles)}))}," 删除 ",8,H)):d("",!0),t.multiSelect?(a(),c("button",{key:2,disabled:t.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[8]||(e[8]=i=>l.cut(t.checkedFiles))}," 剪切 ",8,q)):d("",!0)])]),s("div",J,[s("div",K,[g(s("input",{class:"form-control",style:{flex:"1 1 auto",width:"1%"},placeholder:"搜索","onUpdate:modelValue":e[9]||(e[9]=i=>t.filter=i),onKeyup:e[10]||(e[10]=P(i=>l.search(),["enter"]))},null,544),[[x,t.filter]]),s("div",W,[G,s("ul",Q,[s("li",X,[s("div",Y,[s("input",{class:"form-check-input",type:"checkbox",id:"size",checked:t.columns.includes("size"),onClick:e[11]||(e[11]=i=>l.hideColumn("size"))},null,8,Z),ee])]),s("li",te,[s("div",se,[s("input",{class:"form-check-input",type:"checkbox",id:"contentType",checked:t.columns.includes("contentType"),onClick:e[12]||(e[12]=i=>l.hideColumn("contentType"))},null,8,oe),ie])]),s("li",le,[s("div",ne,[s("input",{class:"form-check-input",type:"checkbox",id:"lastModified",checked:t.columns.includes("lastModified"),onClick:e[13]||(e[13]=i=>l.hideColumn("lastModified"))},null,8,re),ce])])])])])])]),s("table",ae,[s("tbody",null,[s("tr",null,[t.multiSelect?(a(),c("th",{key:0,class:"checkbox",onClick:e[15]||(e[15]=i=>i.target===i.currentTarget&&i.target.querySelector(".form-check-input").click())},[s("input",{type:"checkbox",class:"form-check-input",onClick:e[14]||(e[14]=i=>l.checkAll(i)),checked:Object.keys(t.files).length>0&&t.checkedFiles.length>0&&t.files.folders.length+t.files.files.length>0,indeterminate:Object.keys(t.files).length>0&&t.checkedFiles.length>0&&t.checkedFiles.length<t.files.folders.length+t.files.files.length,disabled:Object.keys(t.files).length>0&&t.files.folders.length+t.files.files.length==0},null,8,de)])):d("",!0),he,t.columns.includes("size")?(a(),c("th",ue,"大小")):d("",!0),t.columns.includes("contentType")?(a(),c("th",me,"类型")):d("",!0),t.columns.includes("lastModified")?(a(),c("th",fe,"修改时间")):d("",!0),pe]),t.currentDirectory!="/"?(a(),c("tr",ke,[s("td",{colspan:"6",onClick:e[16]||(e[16]=i=>l.changeDirectory(l.getParentDirectory(t.currentDirectory)))},ye)])):d("",!0),(a(!0),c(b,null,w(t.files.folders,i=>(a(),c("tr",{key:i},[g(s("td",{class:"checkbox",onClick:e[18]||(e[18]=r=>r.target===r.currentTarget&&r.target.querySelector(".form-check-input").click())},[g(s("input",{type:"checkbox",class:"form-check-input",value:i.relativePath,"onUpdate:modelValue":e[17]||(e[17]=r=>t.checkedFiles=r)},null,8,_e),[[M,t.checkedFiles]])],512),[[C,t.multiSelect]]),s("td",{class:"filename text-truncate",onClick:r=>l.changeDirectory(i.relativePath)},[we,D("  "),s("a",ve,f(i.name),1)],8,be),t.columns.includes("size")?(a(),c("td",Ce,"-")):d("",!0),t.columns.includes("contentType")?(a(),c("td",Me,"-")):d("",!0),t.columns.includes("lastModified")?(a(),c("td",De,f(i.lastModified),1)):d("",!0),s("td",Fe,[s("a",{class:"link-primary",onClick:r=>l.downloadFolder(i.relativePath)},Pe,8,Te),s("a",{class:"link-danger ms-1",onClick:r=>o.$root.showConfirm(function(){l.deleteFile([i.relativePath])})},ze,8,$e),s("div",Ie,[Be,s("ul",Ne,[s("li",null,[s("a",{class:"dropdown-item",onClick:r=>l.cut([i.relativePath])},"剪切",8,Ue)]),s("li",null,[s("a",{class:"dropdown-item",onClick:r=>o.$root.showInput("重命名","输入新文件名",function(){l.rename(i.relativePath)})},"重命名",8,Ee)])])])])]))),128)),(a(!0),c(b,null,w(t.files.files,i=>(a(),c("tr",{key:i},[g(s("td",{class:"checkbox",onClick:e[20]||(e[20]=r=>r.target===r.currentTarget&&r.target.querySelector(".form-check-input").click())},[g(s("input",{type:"checkbox",class:"form-check-input",value:i.relativePath,"onUpdate:modelValue":e[19]||(e[19]=r=>t.checkedFiles=r)},null,8,je),[[M,t.checkedFiles]])],512),[[C,t.multiSelect]]),s("td",Re,[s("i",{class:v(["bi",l.getIcon(i.name,i.fileType)])},null,2),D("  "+f(i.name),1)]),t.columns.includes("size")?(a(),c("td",Ae,f(o.$root.formatBytes(i.length)),1)):d("",!0),t.columns.includes("contentType")?(a(),c("td",Oe,f(i.fileType),1)):d("",!0),t.columns.includes("lastModified")?(a(),c("td",Ve,f(i.lastModified),1)):d("",!0),s("td",Le,[s("a",{class:"link-primary",onClick:r=>l.download(i.relativePath)},Je,8,He),s("a",{class:"link-danger ms-1",onClick:r=>o.$root.showConfirm(function(){l.deleteFile([i.relativePath])})},Ge,8,Ke),s("div",Qe,[Xe,s("ul",Ye,[s("li",null,[i.fileType.includes("image")||i.fileType.includes("text")?(a(),c("a",{key:0,class:"dropdown-item",onClick:r=>l.preview(i.fileType,i.relativePath)},"预览",8,Ze)):d("",!0)]),s("li",null,[s("a",{class:"dropdown-item",onClick:r=>l.share(i.relativePath)},"分享",8,et)]),s("li",null,[s("a",{class:"dropdown-item",onClick:r=>l.cut([i.relativePath])},"剪切",8,tt)]),s("li",null,[s("a",{class:"dropdown-item",onClick:r=>o.$root.showInput("重命名","输入新文件名",function(){l.rename(i.relativePath)})},"重命名",8,st)])])])])]))),128))])])])}const nt=T($,[["render",ot]]);export{nt as default};

import{_ as x,a as u,l as m,c,b as t,F as y,r as g,d,w as p,v as T,e as P,o as a,n as b,t as f,f as w,g as v,h as C}from"./index-b1685731.js";import"./FileSaver.min-9d4ca619.js";let k;const M=u.CancelToken,$={data(){return{currentDirectory:"/",directories:[],files:[],filter:"",multiSelect:!1,checkedFiles:[],cutFiles:[],columns:["size","lastModified"]}},methods:{list(){this.$root.loading=!0,this.files=[],this.checkedFiles=[],k!==void 0&&k(),u.post("file/list",m.stringify({currentDirectory:this.currentDirectory}),{cancelToken:new M(function(e){k=e})}).then(i=>{if(i.success)this.files=i.detail;else{if(i.msg==="没有权限"&&!this.$root.hasToken(()=>this.list()))return;this.$root.showModal("失败",i.msg)}}).catch(i=>{this.$root.showModal("错误",i.message)}).finally(()=>{this.$root.loading=!1})},search(){if(this.filter.trim().length===0){this.list();return}this.$root.loading=!0,this.files=[],this.checkedFiles=[],k!==void 0&&k(),u.post("file/search",m.stringify({filter:this.filter,currentDirectory:this.currentDirectory}),{cancelToken:new M(function(e){k=e})}).then(i=>{i.success?this.files=i.detail:this.$root.showModal("失败",i.msg)}).catch(i=>{i.name!=="CanceledError"&&this.$root.showModal("错误",i.message)}).finally(()=>{this.$root.loading=!1})},changeDirectory(i){this.currentDirectory=i,this.list(),this.getDirectoryHierachy()},getDirectoryHierachy(){this.directories=[];const i=this.currentDirectory.split("/"),e=[];for(let n=0;n<i.length;n++){e.push(i[n]);const h=e.join("/");this.directories.push({displayName:i[n],relativePath:h.length===0?"/":h})}this.directories[0].displayName="Home"},getParentDirectory(i){let e=i.split("/");e.pop();let n=e.join("/");return n.length===0?"/":n},upload(i){if(!this.$root.hasToken(()=>this.upload(i)))return;this.$root.message.title="上传进度";const e=new Modal(this.$root.$refs.progressModal);e.show();const n=new FormData;n.append("currentDirectory",this.currentDirectory),Array.from(i.target.files).forEach(s=>{console.log(s),n.append("files",s)}),u({method:"post",url:"file/upload",data:n,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{const l=s.loaded,o=s.total;this.$root.progress=Math.round(l/o*100)+"%"}}).then(s=>{s.success?(e.hide(),this.list(),this.$root.showModal("成功","上传成功"),this.$root.progress=0):(e.hide(),this.$root.showModal("失败",s.msg),this.$root.progress=0)}).catch(s=>{e.hide(),this.$root.showModal("错误",s.message),this.$root.progress=0})},createDirectory(){const i=this.$root.$refs.input.value;if(i.trim().length===0){this.$root.showModal("提示","文件夹名不能为空");return}this.$root.hasToken(()=>this.createDirectory())&&(this.$root.loading=!0,u.post("file/mkdir",m.stringify({relativePath:this.currentDirectory+"/"+i})).then(e=>{e.success?(this.list(),this.$root.showModal("成功","新建文件夹成功")):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1}))},download(i){this.$root.message.title="正在下载";const e=new Modal(this.$root.$refs.progressModal);e.show();var n=new Date().getTime(),h=0;u({method:"post",url:u.defaults.baseURL+"file/download",data:m.stringify({relativePath:i}),responseType:"blob",onDownloadProgress:s=>{const l=s.loaded,o=s.total;this.$root.progress=Math.round(l*100/o)+"%";var r=new Date().getTime(),D=l-h,_=(r-n)/1e3,F=_?D/_:0;h=l,n=r,this.$root.speed=this.$root.formatBytes(F)+"/s"}}).then(s=>{let l=s.headers["content-disposition"].split("filename=")[1];l=decodeURIComponent(l),saveAs(s.data,l)}).catch(s=>{e.hide(),this.$root.showModal("错误",s.message)}).finally(()=>{this.$root.progress=0,e.hide()})},downloadFolder(i){location.href=u.defaults.baseURL+"file/zip?relativePath="+encodeURIComponent(i)},bulkDownload(){location.href=u.defaults.baseURL+"file/bulk?relativePath="+encodeURIComponent(JSON.stringify(this.checkedFiles))},deleteFile(i){this.$root.hasToken(()=>this.deleteFile(i))&&(this.$root.loading=!0,u.post("file/delete",m.stringify({relativePath:JSON.stringify(i)})).then(e=>{e.success?(this.filter.length===0?this.list():this.search(this.filter),this.$root.showModal("成功","删除成功")):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1}))},rename(i){const e=this.$root.$refs.input.value;if(e.trim().length===0){this.$root.showModal("提示","新文件名不能为空");return}this.$root.hasToken(()=>this.rename(i))&&(this.$root.loading=!0,u.post("file/rename",m.stringify({src:i,dst:this.currentDirectory+"/"+e})).then(n=>{n.success?(this.$root.showModal("成功",n.msg),this.list()):this.$root.showModal("失败",n.msg)}).catch(n=>{this.$root.showModal("错误",n.message)}).finally(()=>{this.$root.loading=!1}))},cut(i){this.cutFiles=i,this.$root.showModal("剪切成功",this.cutFiles.join(`
`))},paste(){this.cutFiles.length!==0&&this.$root.hasToken(()=>this.paste())&&(this.$root.loading=!0,u.post("file/move",m.stringify({src:JSON.stringify(this.cutFiles),dst:this.currentDirectory})).then(i=>{i.success?(this.$root.showModal("成功",i.msg),this.cutFiles=[],this.list()):(this.$root.showModal("失败",i.msg),this.cutFiles=[])}).catch(i=>{this.$root.showModal("错误",i.message),this.cutFiles=[]}).finally(()=>{this.$root.loading=!1}))},preview(i,e){if(i.includes("image")){let n=document.getElementById("image");n.removeAttribute("src"),n.setAttribute("src",u.defaults.baseURL+"file/download?relativePath="+encodeURIComponent(e)),new Modal(this.$root.$refs.imageModal).show()}else if(i.includes("text")){let n=document.getElementById("text");this.$root.loading=!0,n.innerText="",u.post("file/read",m.stringify({relativePath:e})).then(h=>{h.success?(n.innerText=h.detail,new Modal(this.$root.$refs.textModal).show()):this.$root.showModal("失败",h.msg)}).catch(h=>{this.$root.showModal("错误",h.message)}).finally(()=>{this.$root.loading=!1})}},share(i){this.$root.loading=!0,u.post("shareCode/add",m.stringify({path:i})).then(e=>{e.success?this.$root.showModal("分享成功",location.protocol+"//"+location.host+"/files/"+e.detail):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1})},checkAll(i){i.target.checked?(this.files.folders.forEach(e=>{this.checkedFiles.push(e.relativePath)}),this.files.files.forEach(e=>{this.checkedFiles.push(e.relativePath)})):this.checkedFiles=[]},hideColumn(i){this.columns.includes(i)?this.columns=this.columns.filter(e=>e!==i):this.columns.push(i)},getIcon(i,e){const n=i.split(".").pop(),h={"bi-file-earmark-binary":["exe"],"bi-file-earmark-zip":["zip","7z","rar"],"bi-file-earmark-code":["py","java","c","cpp","html","js","css"],"bi-file-earmark-pdf":["pdf"],"bi-file-earmark-word":["doc","docx"],"bi-file-earmark-excel":["xls","xlsx"],"bi-file-earmark-ppt":["ppt","pptx"]};for(const[o,r]of Object.entries(h))if(r.includes(n))return o;let l={text:"bi-file-earmark-text",image:"bi-file-earmark-image",audio:"bi-file-earmark-music",video:"bi-file-earmark-play"}[e.split("/")[0]];return l??" bi-file-earmark"}},mounted(){this.list(),this.getDirectoryHierachy()}},S={class:"card border-bottom-0"},z={class:"card-header"},I={class:"breadcrumb float-start",style:{margin:"0.5rem 0"}},B={key:0},N=["onClick"],U={class:"card-body"},E={id:"form",action:"upload",method:"post",enctype:"multipart/form-data"},j={class:"files-left"},R=t("button",{class:"btn btn-outline-primary",onclick:"document.getElementById('file').value=null; document.getElementById('file').click()"}," 上传文件 ",-1),O=t("button",{class:"btn btn-outline-primary ms-1",onclick:"document.getElementById('folder').value=null; document.getElementById('folder').click()"}," 上传文件夹 ",-1),A={class:"btn-group"},V=["disabled"],L=["disabled"],H=["disabled"],q=["disabled"],J={class:"files-right"},K={class:"w-100 d-flex"},W={class:"dropdown",style:{"padding-left":"5px"}},G=t("button",{class:"btn btn-outline-primary dropdown-toggle","data-bs-toggle":"dropdown","data-bs-auto-close":"outside"},[t("i",{class:"bi bi-grid-3x3-gap-fill"})],-1),Q={class:"dropdown-menu"},X={class:"dropdown-item"},Y={class:"form-check"},Z=["checked"],ee=t("label",{class:"form-check-label",for:"size"},"大小",-1),te={class:"dropdown-item"},se={class:"form-check"},ie=["checked"],oe=t("label",{class:"form-check-label",for:"contentType"},"类型",-1),le={class:"dropdown-item"},ne={class:"form-check"},re=["checked"],ce=t("label",{class:"form-check-label",for:"lastModified"},"修改日期",-1),ae={class:"mb-0 table table-hover"},de=["checked","indeterminate","disabled"],he=t("th",{class:"filename text-truncate"},"文件名",-1),ue={key:1,class:"size"},me={key:2,class:"contentType"},fe={key:3,class:"lastModified"},ke=t("th",{class:"action"},"操作",-1),pe={key:0},ye=t("a",{class:"link-primary"},"..",-1),ge=[ye],_e=["value"],be=["onClick"],we=t("i",{class:"bi bi-folder2"},null,-1),ve={class:"link-primary"},Ce={key:0,class:"size"},Me={key:1,class:"contentType"},De={key:2,class:"lastModified"},Fe={class:"action"},xe=["onClick"],Te=t("i",{class:"bi bi-cloud-download"},null,-1),Pe=[Te],$e=["onClick"],Se=t("i",{class:"bi bi-trash"},null,-1),ze=[Se],Ie={class:"dropdown d-inline"},Be=t("a",{class:"link-primary ms-1","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"bi bi-three-dots"})],-1),Ne={class:"dropdown-menu"},Ue=["onClick"],Ee=["onClick"],je=["value"],Re={class:"filename text-truncate"},Oe={key:0,class:"size"},Ae={key:1,class:"contentType"},Ve={key:2,class:"lastModified"},Le={class:"action"},He=["onClick"],qe=t("i",{class:"bi bi-cloud-download"},null,-1),Je=[qe],Ke=["onClick"],We=t("i",{class:"bi bi-trash"},null,-1),Ge=[We],Qe={class:"dropdown d-inline"},Xe=t("a",{class:"link-primary ms-1","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"bi bi-three-dots"})],-1),Ye={class:"dropdown-menu"},Ze=["onClick"],et=["onClick"],tt=["onClick"],st=["onClick"];function it(i,e,n,h,s,l){return a(),c("div",S,[t("div",z,[t("ol",I,[(a(!0),c(y,null,g(s.directories,o=>(a(),c("li",{class:b(["filename text-truncate",["breadcrumb-item",{active:o.relativePath==s.currentDirectory}]]),key:o},[o.relativePath==s.currentDirectory?(a(),c("a",B,f(o.displayName),1)):(a(),c("a",{key:1,class:"link-primary",onClick:r=>l.changeDirectory(o.relativePath)},f(o.displayName),9,N))],2))),128))])]),t("div",U,[t("form",E,[t("input",{type:"file",name:"file",id:"file",class:"d-none",onChange:e[0]||(e[0]=o=>l.upload(o)),multiple:""},null,32),t("input",{type:"file",name:"folder",id:"folder",class:"d-none",onChange:e[1]||(e[1]=o=>l.upload(o)),multiple:"",webkitdirectory:""},null,32)]),t("div",j,[R,O,t("button",{class:"btn btn-outline-primary ms-1 me-1",onClick:e[2]||(e[2]=o=>i.$root.showInput("新建文件夹","输入文件夹名",l.createDirectory))}," 新建文件夹 "),t("button",{class:"btn btn-outline-primary me-1",onClick:e[3]||(e[3]=o=>l.list())}," 刷新 "),s.cutFiles.length!==0&&l.getParentDirectory(s.cutFiles[0])!==s.currentDirectory&&!s.currentDirectory.startsWith(s.cutFiles[0])?(a(),c("button",{key:0,class:"btn btn-outline-primary me-1",onClick:e[4]||(e[4]=o=>l.paste())}," 粘贴 ")):d("",!0),t("div",A,[t("button",{class:"btn btn-outline-primary",disabled:s.files.length===0,onClick:e[5]||(e[5]=o=>{s.multiSelect=!s.multiSelect,s.checkedFiles=[]})}," 多选 ",8,V),s.multiSelect?(a(),c("button",{key:0,disabled:s.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[6]||(e[6]=o=>l.bulkDownload())}," 下载 ",8,L)):d("",!0),s.multiSelect?(a(),c("button",{key:1,disabled:s.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[7]||(e[7]=o=>i.$root.showConfirm(function(){l.deleteFile(s.checkedFiles)}))}," 删除 ",8,H)):d("",!0),s.multiSelect?(a(),c("button",{key:2,disabled:s.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[8]||(e[8]=o=>l.cut(s.checkedFiles))}," 剪切 ",8,q)):d("",!0)])]),t("div",J,[t("div",K,[p(t("input",{class:"form-control",style:{flex:"1 1 auto",width:"1%"},placeholder:"搜索","onUpdate:modelValue":e[9]||(e[9]=o=>s.filter=o),onKeyup:e[10]||(e[10]=P(o=>l.search(),["enter"]))},null,544),[[T,s.filter]]),t("div",W,[G,t("ul",Q,[t("li",X,[t("div",Y,[t("input",{class:"form-check-input",type:"checkbox",id:"size",checked:s.columns.includes("size"),onClick:e[11]||(e[11]=o=>l.hideColumn("size"))},null,8,Z),ee])]),t("li",te,[t("div",se,[t("input",{class:"form-check-input",type:"checkbox",id:"contentType",checked:s.columns.includes("contentType"),onClick:e[12]||(e[12]=o=>l.hideColumn("contentType"))},null,8,ie),oe])]),t("li",le,[t("div",ne,[t("input",{class:"form-check-input",type:"checkbox",id:"lastModified",checked:s.columns.includes("lastModified"),onClick:e[13]||(e[13]=o=>l.hideColumn("lastModified"))},null,8,re),ce])])])])])])]),t("table",ae,[t("tbody",null,[t("tr",null,[s.multiSelect?(a(),c("th",{key:0,class:"checkbox",onClick:e[15]||(e[15]=o=>o.target===o.currentTarget&&o.target.querySelector(".form-check-input").click())},[t("input",{type:"checkbox",class:"form-check-input",onClick:e[14]||(e[14]=o=>l.checkAll(o)),checked:Object.keys(s.files).length>0&&s.checkedFiles.length>0&&s.files.folders.length+s.files.files.length>0,indeterminate:Object.keys(s.files).length>0&&s.checkedFiles.length>0&&s.checkedFiles.length<s.files.folders.length+s.files.files.length,disabled:Object.keys(s.files).length>0&&s.files.folders.length+s.files.files.length==0},null,8,de)])):d("",!0),he,s.columns.includes("size")?(a(),c("th",ue,"大小")):d("",!0),s.columns.includes("contentType")?(a(),c("th",me,"类型")):d("",!0),s.columns.includes("lastModified")?(a(),c("th",fe,"修改时间")):d("",!0),ke]),s.currentDirectory!="/"?(a(),c("tr",pe,[t("td",{colspan:"6",onClick:e[16]||(e[16]=o=>l.changeDirectory(l.getParentDirectory(s.currentDirectory)))},ge)])):d("",!0),(a(!0),c(y,null,g(s.files.folders,o=>(a(),c("tr",{key:o},[p(t("td",{class:"checkbox",onClick:e[18]||(e[18]=r=>r.target===r.currentTarget&&r.target.querySelector(".form-check-input").click())},[p(t("input",{type:"checkbox",class:"form-check-input",value:o.relativePath,"onUpdate:modelValue":e[17]||(e[17]=r=>s.checkedFiles=r)},null,8,_e),[[v,s.checkedFiles]])],512),[[w,s.multiSelect]]),t("td",{class:"filename text-truncate",onClick:r=>l.changeDirectory(o.relativePath)},[we,C("  "),t("a",ve,f(o.name),1)],8,be),s.columns.includes("size")?(a(),c("td",Ce,"-")):d("",!0),s.columns.includes("contentType")?(a(),c("td",Me,"-")):d("",!0),s.columns.includes("lastModified")?(a(),c("td",De,f(o.lastModified),1)):d("",!0),t("td",Fe,[t("a",{class:"link-primary",onClick:r=>l.downloadFolder(o.relativePath)},Pe,8,xe),t("a",{class:"link-danger ms-1",onClick:r=>i.$root.showConfirm(function(){l.deleteFile([o.relativePath])})},ze,8,$e),t("div",Ie,[Be,t("ul",Ne,[t("li",null,[t("a",{class:"dropdown-item",onClick:r=>l.cut([o.relativePath])},"剪切",8,Ue)]),t("li",null,[t("a",{class:"dropdown-item",onClick:r=>i.$root.showInput("重命名","输入新文件名",function(){l.rename(o.relativePath)})},"重命名",8,Ee)])])])])]))),128)),(a(!0),c(y,null,g(s.files.files,o=>(a(),c("tr",{key:o},[p(t("td",{class:"checkbox",onClick:e[20]||(e[20]=r=>r.target===r.currentTarget&&r.target.querySelector(".form-check-input").click())},[p(t("input",{type:"checkbox",class:"form-check-input",value:o.relativePath,"onUpdate:modelValue":e[19]||(e[19]=r=>s.checkedFiles=r)},null,8,je),[[v,s.checkedFiles]])],512),[[w,s.multiSelect]]),t("td",Re,[t("i",{class:b(["bi",l.getIcon(o.name,o.fileType)])},null,2),C("  "+f(o.name),1)]),s.columns.includes("size")?(a(),c("td",Oe,f(i.$root.formatBytes(o.length)),1)):d("",!0),s.columns.includes("contentType")?(a(),c("td",Ae,f(o.fileType),1)):d("",!0),s.columns.includes("lastModified")?(a(),c("td",Ve,f(o.lastModified),1)):d("",!0),t("td",Le,[t("a",{class:"link-primary",onClick:r=>l.download(o.relativePath)},Je,8,He),t("a",{class:"link-danger ms-1",onClick:r=>i.$root.showConfirm(function(){l.deleteFile([o.relativePath])})},Ge,8,Ke),t("div",Qe,[Xe,t("ul",Ye,[t("li",null,[o.fileType.includes("image")||o.fileType.includes("text")?(a(),c("a",{key:0,class:"dropdown-item",onClick:r=>l.preview(o.fileType,o.relativePath)},"预览",8,Ze)):d("",!0)]),t("li",null,[t("a",{class:"dropdown-item",onClick:r=>l.share(o.relativePath)},"分享",8,et)]),t("li",null,[t("a",{class:"dropdown-item",onClick:r=>l.cut([o.relativePath])},"剪切",8,tt)]),t("li",null,[t("a",{class:"dropdown-item",onClick:r=>i.$root.showInput("重命名","输入新文件名",function(){l.rename(o.relativePath)})},"重命名",8,st)])])])])]))),128))])])])}const nt=x($,[["render",it]]);export{nt as default};

import{_ as g,a as d,l as m,c as i,w as u,v as p,b as t,e as v,F as _,r as x,o as l,i as b,t as n,h as f,d as w}from"./index-724d87ef.js";import{h as c}from"./moment-fbc5633a.js";const k={data(){return{pastes:[],title:"",text:""}},methods:{getFromNow(e){return c(e).fromNow()},calcExpiredDate(e){if(e!=0){if(e==-1)return-1;var o=c(new Date).add(e,"m").toDate();return c(o).format("YYYY-MM-DD HH:mm:ss")}},list(){this.$root.loading=!0,d.post("/paste/list").then(e=>{e.success?this.pastes=e.detail:this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1})},add(){if(this.text.trim().length===0){this.$root.showModal("提示","正文不能为空");return}this.$root.loading=!0,d.post("/paste/add",m.stringify({title:this.title.trim().length===0?"未命名":this.title,text:this.text,expiredDate:this.calcExpiredDate(this.$refs.select.value),isPrivate:this.$refs.isPrivate.checked})).then(e=>{e.success?(this.list(),this.$root.showModal("发布成功",location.protocol+"//"+location.host+"/pastes/"+e.detail.id),this.text="",this.title=""):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1})},remove(e){this.$root.hasToken(()=>this.remove(e))&&(this.$root.loading=!0,d.post("/paste/delete",m.stringify({id:e})).then(o=>{o.success?(this.$root.showModal("成功","删除成功"),this.list()):this.$root.showModal("失败",o.msg)}).catch(o=>{this.$root.showModal("错误",o.message)}).finally(()=>{this.$root.loading=!1}))}},created(){this.list()}},$={class:"float-end mb-3 row g-3 align-middle"},y={class:"col-auto"},M={class:"form-check form-switch",style:{padding:"0.375rem 0.75rem"}},D={class:"form-check-input",type:"checkbox",role:"switch",id:"isPrivate",ref:"isPrivate"},C=t("label",{class:"form-check-label",for:"isPrivate"},"私密",-1),N={class:"col-auto"},P={class:"form-select mb-2",ref:"select"},T=["selected"],V=t("option",{value:"60"},"1小时",-1),E=t("option",{value:"1440"},"1天",-1),F=t("option",{value:"10080"},"1周",-1),Y=t("option",{value:"-1"},"阅后即焚",-1),B=["selected"],H={class:"col-auto"},K={class:"list-group clear-both"},U=["onClick"],j={class:"float-end"},z=["data-clipboard-text"],A=["onClick"],L={class:"text-primary text-truncate mw-75"},O={class:"text-truncate mw-75"},S={class:"text-muted mb-0"},q={key:0,class:"text-danger",style:{"font-size":"0.875rem"}},G={key:0},I={key:1};function J(e,o,Q,R,a,r){return l(),i(_,null,[u(t("input",{class:"form-control mb-2",placeholder:"标题","onUpdate:modelValue":o[0]||(o[0]=s=>a.title=s)},null,512),[[p,a.title]]),u(t("textarea",{class:"form-control mb-3",rows:"10",placeholder:"正文","onUpdate:modelValue":o[1]||(o[1]=s=>a.text=s),onKeyup:o[2]||(o[2]=v(b(s=>r.add(),["ctrl"]),["enter"]))},null,544),[[p,a.text]]),t("div",$,[t("div",y,[t("div",M,[t("input",D,null,512),C])]),t("div",N,[t("select",P,[t("option",{value:"10",selected:e.$root.noToken()},"10分钟",8,T),V,E,F,Y,t("option",{value:"0",selected:!e.$root.noToken()},"永不过期",8,B)],512)]),t("div",H,[t("button",{class:"btn btn-outline-primary mb-2 col-auto",onClick:o[3]||(o[3]=s=>r.add())},"发布")])]),t("ul",K,[(l(!0),i(_,null,x(a.pastes,s=>(l(),i("li",{class:"list-group-item list-group-item-action cursor-pointer",key:s,onClick:h=>h.target.tagName!=="A"&&e.$router.push("/pastes/"+s.id)},[t("div",j,[t("a",{class:"link-primary bi bi-clipboard",id:"btnCopy","data-clipboard-text":s.text},null,8,z),t("a",{class:"link-danger bi bi-trash ms-1",onClick:h=>e.$root.showConfirm(()=>r.remove(s.id))},null,8,A)]),t("div",null,[t("p",L,n(s.title),1),t("p",O,[t("i",null,n(s.text),1)]),t("p",S,[f("发布于 "+n(s.time.slice(0,-3))+" ",1),s.expiredDate?(l(),i("span",q,[f("   "),s.expiredDate==-1?(l(),i("span",G,"阅后即焚")):(l(),i("span",I,"Expired "+n(r.getFromNow(s.expiredDate)),1))])):w("",!0)])])],8,U))),128))])],64)}const Z=g(k,[["render",J]]);export{Z as default};

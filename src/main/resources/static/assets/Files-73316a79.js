import{_ as P,a as h,l as f,c,b as o,F as v,r as w,d as u,w as b,v as S,e as I,o as a,n as C,t as g,f as D,g as $,h as T,p as z,i as B}from"./index-bd898a27.js";import"./FileSaver.min-8708b00c.js";let y;const F=h.CancelToken,U={data(){return{currentDirectory:"/",directories:[],files:[],filter:"",multiSelect:!1,checkedFiles:[],cutFiles:[],columns:["size","lastModified"]}},methods:{list(){this.$root.loading=!0,this.files=[],this.checkedFiles=[],y!==void 0&&y(),h.post("file/list",f.stringify({currentDirectory:this.currentDirectory}),{cancelToken:new F(function(e){y=e})}).then(i=>{if(i.success)this.files=i.detail;else{if(i.msg==="没有权限"&&!this.$root.hasToken(()=>this.list()))return;this.$root.showModal("失败",i.msg)}}).catch(i=>{this.$root.showModal("错误",i.message)}).finally(()=>{this.$root.loading=!1})},search(){if(this.filter.trim().length===0){this.list();return}this.$root.loading=!0,this.files=[],this.checkedFiles=[],y!==void 0&&y(),h.post("file/search",f.stringify({filter:this.filter,currentDirectory:this.currentDirectory}),{cancelToken:new F(function(e){y=e})}).then(i=>{i.success?this.files=i.detail:this.$root.showModal("失败",i.msg)}).catch(i=>{i.name!=="CanceledError"&&this.$root.showModal("错误",i.message)}).finally(()=>{this.$root.loading=!1})},changeDirectory(i){this.currentDirectory=i,this.list(),this.getDirectoryHierachy()},getDirectoryHierachy(){this.directories=[];const i=this.currentDirectory.split("/"),e=[];for(let r=0;r<i.length;r++){e.push(i[r]);const d=e.join("/");this.directories.push({displayName:i[r],relativePath:d.length===0?"/":d})}this.directories[0].displayName="Home"},getParentDirectory(i){let e=i.split("/");e.pop();let r=e.join("/");return r.length===0?"/":r},upload(i){if(!this.$root.hasToken(()=>this.upload(i)))return;this.$root.message.title="上传进度";const e=new Modal(this.$root.$refs.progressModal);e.show();const r=new FormData;r.append("currentDirectory",this.currentDirectory),Array.from(i.target.files).forEach(s=>{console.log(s),r.append("files",s)});var t=new Date().getTime(),l=0;h({method:"post",url:"file/upload",data:r,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{const n=s.loaded,k=s.total;this.$root.progress=Math.round(n/k*100)+"%";var p=new Date().getTime(),_=n-l,M=(p-t)/1e3,x=M?_/M:0;l=n,t=p,this.$root.speed=this.$root.formatBytes(x)+"/s"}}).then(s=>{s.success?(e.hide(),this.list(),this.$root.showModal("成功","上传成功"),this.$root.progress=0):(e.hide(),this.$root.showModal("失败",s.msg),this.$root.progress=0)}).catch(s=>{e.hide(),this.$root.showModal("错误",s.message),this.$root.progress=0})},createDirectory(){const i=this.$root.$refs.input.value;if(i.trim().length===0){this.$root.showModal("提示","文件夹名不能为空");return}this.$root.hasToken(()=>this.createDirectory())&&(this.$root.loading=!0,h.post("file/mkdir",f.stringify({relativePath:this.currentDirectory+"/"+i})).then(e=>{e.success?(this.list(),this.$root.showModal("成功","新建文件夹成功")):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1}))},download(i){this.$root.message.title="正在下载";const e=new Modal(this.$root.$refs.progressModal);e.show();var r=new Date().getTime(),d=0;h({method:"post",url:h.defaults.baseURL+"file/download",data:f.stringify({relativePath:i}),responseType:"blob",onDownloadProgress:t=>{const l=t.loaded,s=t.total;this.$root.progress=Math.round(l*100/s)+"%";var n=new Date().getTime(),k=l-d,p=(n-r)/1e3,_=p?k/p:0;d=l,r=n,this.$root.speed=this.$root.formatBytes(_)+"/s"}}).then(t=>{let l=t.headers["content-disposition"].split("filename=")[1];l=decodeURIComponent(l),saveAs(t.data,l)}).catch(t=>{e.hide(),this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.progress=0,e.hide()})},downloadFolder(i){this.$root.message.title="正在下载";const e=new Modal(this.$root.$refs.progressModal);e.show();var r=new Date().getTime(),d=0;h({method:"post",url:h.defaults.baseURL+"file/zip",data:f.stringify({relativePath:i}),responseType:"blob",onDownloadProgress:t=>{const l=t.loaded,s=t.total;this.$root.progress=Math.round(l*100/s)+"%";var n=new Date().getTime(),k=l-d,p=(n-r)/1e3,_=p?k/p:0;d=l,r=n,this.$root.speed=this.$root.formatBytes(_)+"/s"}}).then(t=>{let l=t.headers["content-disposition"].split("filename=")[1];l=decodeURIComponent(l),saveAs(t.data,l)}).catch(t=>{e.hide(),this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.progress=0,e.hide()})},bulkDownload(){this.$root.message.title="正在下载";const i=new Modal(this.$root.$refs.progressModal);i.show();var e=new Date().getTime(),r=0;h({method:"post",url:h.defaults.baseURL+"file/bulk",data:f.stringify({relativePath:JSON.stringify(this.checkedFiles)}),responseType:"blob",onDownloadProgress:d=>{const t=d.loaded,l=d.total;this.$root.progress=Math.round(t*100/l)+"%";var s=new Date().getTime(),n=t-r,k=(s-e)/1e3,p=k?n/k:0;r=t,e=s,this.$root.speed=this.$root.formatBytes(p)+"/s"}}).then(d=>{let t=d.headers["content-disposition"].split("filename=")[1];t=decodeURIComponent(t),saveAs(d.data,t)}).catch(d=>{i.hide(),this.$root.showModal("错误",d.message)}).finally(()=>{this.$root.progress=0,i.hide()})},deleteFile(i){this.$root.hasToken(()=>this.deleteFile(i))&&(this.$root.loading=!0,h.post("file/delete",f.stringify({relativePath:JSON.stringify(i)})).then(e=>{e.success?(this.filter.length===0?this.list():this.search(this.filter),this.$root.showModal("成功","删除成功")):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1}))},rename(i){const e=this.$root.$refs.input.value;if(e.trim().length===0){this.$root.showModal("提示","新文件名不能为空");return}this.$root.hasToken(()=>this.rename(i))&&(this.$root.loading=!0,h.post("file/rename",f.stringify({src:i,dst:this.currentDirectory+"/"+e})).then(r=>{r.success?(this.$root.showModal("成功",r.msg),this.list()):this.$root.showModal("失败",r.msg)}).catch(r=>{this.$root.showModal("错误",r.message)}).finally(()=>{this.$root.loading=!1}))},cut(i){this.cutFiles=i,this.$root.showModal("剪切成功",this.cutFiles.join(`
`))},paste(){this.cutFiles.length!==0&&this.$root.hasToken(()=>this.paste())&&(this.$root.loading=!0,h.post("file/move",f.stringify({src:JSON.stringify(this.cutFiles),dst:this.currentDirectory})).then(i=>{i.success?(this.$root.showModal("成功",i.msg),this.cutFiles=[],this.list()):(this.$root.showModal("失败",i.msg),this.cutFiles=[])}).catch(i=>{this.$root.showModal("错误",i.message),this.cutFiles=[]}).finally(()=>{this.$root.loading=!1}))},preview(i,e){i.includes("text")?(this.$root.loading=!0,this.$root.message.title=e,this.$root.message.text="",h.post("file/read",f.stringify({relativePath:e})).then(r=>{r.success?(this.$root.message.text=r.detail,new Modal(this.$root.$refs.textModal).show()):this.$root.showModal("失败",r.msg)}).catch(r=>{this.$root.showModal("错误",r.message)}).finally(()=>{this.$root.loading=!1})):i.includes("image")?(this.$root.src=h.defaults.baseURL+"file/download?relativePath="+encodeURIComponent(e),new Modal(this.$root.$refs.imageModal).show()):i.includes("video")&&(this.$root.src=h.defaults.baseURL+"file/download?relativePath="+encodeURIComponent(e),new Modal(this.$root.$refs.videoModal).show())},share(i){this.$root.loading=!0,h.post("shareCode/add",f.stringify({path:i})).then(e=>{e.success?this.$root.showModal("分享成功",location.protocol+"//"+location.host+"/files/"+e.detail):this.$root.showModal("失败",e.msg)}).catch(e=>{this.$root.showModal("错误",e.message)}).finally(()=>{this.$root.loading=!1})},checkAll(i){i.target.checked?(this.files.folders.forEach(e=>{this.checkedFiles.push(e.relativePath)}),this.files.files.forEach(e=>{this.checkedFiles.push(e.relativePath)})):this.checkedFiles=[]},hideColumn(i){this.columns.includes(i)?this.columns=this.columns.filter(e=>e!==i):this.columns.push(i)},getIcon(i,e){const r=i.split(".").pop(),d={"bi-file-earmark-binary":["exe"],"bi-file-earmark-zip":["zip","7z","rar"],"bi-file-earmark-code":["py","java","c","cpp","html","js","css"],"bi-file-earmark-pdf":["pdf"],"bi-file-earmark-word":["doc","docx"],"bi-file-earmark-excel":["xls","xlsx"],"bi-file-earmark-ppt":["ppt","pptx"]};for(const[s,n]of Object.entries(d))if(n.includes(r))return s;let l={text:"bi-file-earmark-text",image:"bi-file-earmark-image",audio:"bi-file-earmark-music",video:"bi-file-earmark-play"}[e.split("/")[0]];return l??" bi-file-earmark"}},mounted(){this.list(),this.getDirectoryHierachy()}},m=i=>(z("data-v-ac7ac692"),i=i(),B(),i),N={class:"card border-bottom-0"},R={class:"card-header"},j={class:"breadcrumb float-start",style:{margin:"0.5rem 0"}},E={key:0},O=["onClick"],A={class:"card-body"},L={id:"form",action:"upload",method:"post",enctype:"multipart/form-data"},V={class:"files-left"},H=m(()=>o("button",{class:"btn btn-outline-primary",onclick:"document.getElementById('file').value=null; document.getElementById('file').click()"}," 上传文件 ",-1)),q=m(()=>o("button",{class:"btn btn-outline-primary ms-1 me-1",onclick:"document.getElementById('folder').value=null; document.getElementById('folder').click()"}," 上传文件夹 ",-1)),J={class:"btn-group"},K=["disabled"],W=["disabled"],G=["disabled"],Q=["disabled"],X={class:"files-right"},Y={class:"w-100 d-flex"},Z={class:"dropdown",style:{"padding-left":"5px"}},ee=m(()=>o("button",{class:"btn btn-outline-primary dropdown-toggle","data-bs-toggle":"dropdown","data-bs-auto-close":"outside"},[o("i",{class:"bi bi-grid-3x3-gap-fill"})],-1)),te={class:"dropdown-menu"},se={class:"dropdown-item"},oe={class:"form-check"},ie=["checked"],le=m(()=>o("label",{class:"form-check-label",for:"size"},"大小",-1)),ne={class:"dropdown-item"},re={class:"form-check"},ce=["checked"],ae=m(()=>o("label",{class:"form-check-label",for:"contentType"},"类型",-1)),de={class:"dropdown-item"},he={class:"form-check"},ue=["checked"],me=m(()=>o("label",{class:"form-check-label",for:"lastModified"},"修改日期",-1)),fe={class:"mb-0 table table-hover"},pe=["checked","indeterminate","disabled"],ke=m(()=>o("th",{class:"filename text-truncate"},"文件名",-1)),ge={key:1,class:"size"},ye={key:2,class:"contentType"},_e={key:3,class:"lastModified"},be=m(()=>o("th",{class:"action"},"操作",-1)),ve={key:0},we=m(()=>o("a",{class:"link-primary"},"..",-1)),Me=[we],Ce=["value"],De=["onClick"],$e=m(()=>o("i",{class:"bi bi-folder2"},null,-1)),Te={class:"link-primary"},Fe={key:0,class:"size"},xe={key:1,class:"contentType"},Pe={key:2,class:"lastModified"},Se={class:"action"},Ie=["onClick"],ze=m(()=>o("i",{class:"bi bi-cloud-download"},null,-1)),Be=[ze],Ue=["onClick"],Ne=m(()=>o("i",{class:"bi bi-trash"},null,-1)),Re=[Ne],je={class:"dropdown d-inline"},Ee=m(()=>o("a",{class:"link-primary ms-1","data-bs-toggle":"dropdown","aria-expanded":"false"},[o("i",{class:"bi bi-three-dots"})],-1)),Oe={class:"dropdown-menu"},Ae=["onClick"],Le=["onClick"],Ve=["value"],He={class:"filename text-truncate"},qe={key:0,class:"size"},Je={key:1,class:"contentType"},Ke={key:2,class:"lastModified"},We={class:"action"},Ge=["onClick"],Qe=m(()=>o("i",{class:"bi bi-cloud-download"},null,-1)),Xe=[Qe],Ye=["onClick"],Ze=m(()=>o("i",{class:"bi bi-trash"},null,-1)),et=[Ze],tt={class:"dropdown d-inline"},st=m(()=>o("a",{class:"link-primary ms-1","data-bs-toggle":"dropdown","aria-expanded":"false"},[o("i",{class:"bi bi-three-dots"})],-1)),ot={class:"dropdown-menu"},it=["onClick"],lt=["onClick"],nt=["onClick"],rt=["onClick"];function ct(i,e,r,d,t,l){return a(),c("div",N,[o("div",R,[o("ol",j,[(a(!0),c(v,null,w(t.directories,s=>(a(),c("li",{class:C(["filename text-truncate",["breadcrumb-item",{active:s.relativePath==t.currentDirectory}]]),key:s},[s.relativePath==t.currentDirectory?(a(),c("a",E,g(s.displayName),1)):(a(),c("a",{key:1,class:"link-primary",onClick:n=>l.changeDirectory(s.relativePath)},g(s.displayName),9,O))],2))),128))])]),o("div",A,[o("form",L,[o("input",{type:"file",name:"file",id:"file",class:"d-none",onChange:e[0]||(e[0]=s=>l.upload(s)),multiple:""},null,32),o("input",{type:"file",name:"folder",id:"folder",class:"d-none",onChange:e[1]||(e[1]=s=>l.upload(s)),multiple:"",webkitdirectory:""},null,32)]),o("div",V,[H,q,o("button",{class:"btn btn-outline-primary me-1",onClick:e[2]||(e[2]=s=>i.$root.showInput("新建文件夹","输入文件夹名",l.createDirectory))}," 新建文件夹 "),o("button",{class:"btn btn-outline-primary me-1",onClick:e[3]||(e[3]=s=>l.list())}," 刷新 "),t.cutFiles.length!==0&&l.getParentDirectory(t.cutFiles[0])!==t.currentDirectory&&!t.currentDirectory.startsWith(t.cutFiles[0])?(a(),c("button",{key:0,class:"btn btn-outline-primary me-1",onClick:e[4]||(e[4]=s=>l.paste())}," 粘贴 ")):u("",!0),o("div",J,[o("button",{class:"btn btn-outline-primary",disabled:t.files.length===0,onClick:e[5]||(e[5]=s=>{t.multiSelect=!t.multiSelect,t.checkedFiles=[]})}," 多选 ",8,K),t.multiSelect?(a(),c("button",{key:0,disabled:t.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[6]||(e[6]=s=>l.bulkDownload())}," 下载 ",8,W)):u("",!0),t.multiSelect?(a(),c("button",{key:1,disabled:t.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[7]||(e[7]=s=>i.$root.showConfirm(function(){l.deleteFile(t.checkedFiles)}))}," 删除 ",8,G)):u("",!0),t.multiSelect?(a(),c("button",{key:2,disabled:t.checkedFiles.length==0,class:"btn btn-outline-primary",onClick:e[8]||(e[8]=s=>l.cut(t.checkedFiles))}," 剪切 ",8,Q)):u("",!0)])]),o("div",X,[o("div",Y,[b(o("input",{class:"form-control",style:{flex:"1 1 auto",width:"1%"},placeholder:"搜索","onUpdate:modelValue":e[9]||(e[9]=s=>t.filter=s),onKeyup:e[10]||(e[10]=I(s=>l.search(),["enter"]))},null,544),[[S,t.filter]]),o("div",Z,[ee,o("ul",te,[o("li",se,[o("div",oe,[o("input",{class:"form-check-input",type:"checkbox",id:"size",checked:t.columns.includes("size"),onClick:e[11]||(e[11]=s=>l.hideColumn("size"))},null,8,ie),le])]),o("li",ne,[o("div",re,[o("input",{class:"form-check-input",type:"checkbox",id:"contentType",checked:t.columns.includes("contentType"),onClick:e[12]||(e[12]=s=>l.hideColumn("contentType"))},null,8,ce),ae])]),o("li",de,[o("div",he,[o("input",{class:"form-check-input",type:"checkbox",id:"lastModified",checked:t.columns.includes("lastModified"),onClick:e[13]||(e[13]=s=>l.hideColumn("lastModified"))},null,8,ue),me])])])])])])]),o("table",fe,[o("tbody",null,[o("tr",null,[t.multiSelect?(a(),c("th",{key:0,class:"checkbox",onClick:e[15]||(e[15]=s=>s.target===s.currentTarget&&s.target.querySelector(".form-check-input").click())},[o("input",{type:"checkbox",class:"form-check-input",onClick:e[14]||(e[14]=s=>l.checkAll(s)),checked:Object.keys(t.files).length>0&&t.checkedFiles.length>0&&t.files.folders.length+t.files.files.length>0,indeterminate:Object.keys(t.files).length>0&&t.checkedFiles.length>0&&t.checkedFiles.length<t.files.folders.length+t.files.files.length,disabled:Object.keys(t.files).length>0&&t.files.folders.length+t.files.files.length==0},null,8,pe)])):u("",!0),ke,t.columns.includes("size")?(a(),c("th",ge,"大小")):u("",!0),t.columns.includes("contentType")?(a(),c("th",ye,"类型")):u("",!0),t.columns.includes("lastModified")?(a(),c("th",_e,"修改时间")):u("",!0),be]),t.currentDirectory!="/"?(a(),c("tr",ve,[o("td",{colspan:"6",onClick:e[16]||(e[16]=s=>l.changeDirectory(l.getParentDirectory(t.currentDirectory)))},Me)])):u("",!0),(a(!0),c(v,null,w(t.files.folders,s=>(a(),c("tr",{key:s},[b(o("td",{class:"checkbox",onClick:e[18]||(e[18]=n=>n.target===n.currentTarget&&n.target.querySelector(".form-check-input").click())},[b(o("input",{type:"checkbox",class:"form-check-input",value:s.relativePath,"onUpdate:modelValue":e[17]||(e[17]=n=>t.checkedFiles=n)},null,8,Ce),[[$,t.checkedFiles]])],512),[[D,t.multiSelect]]),o("td",{class:"filename text-truncate",onClick:n=>l.changeDirectory(s.relativePath)},[$e,T("  "),o("a",Te,g(s.name),1)],8,De),t.columns.includes("size")?(a(),c("td",Fe,"-")):u("",!0),t.columns.includes("contentType")?(a(),c("td",xe,"-")):u("",!0),t.columns.includes("lastModified")?(a(),c("td",Pe,g(s.lastModified),1)):u("",!0),o("td",Se,[o("a",{class:"link-primary",onClick:n=>l.downloadFolder(s.relativePath)},Be,8,Ie),o("a",{class:"link-danger ms-1",onClick:n=>i.$root.showConfirm(function(){l.deleteFile([s.relativePath])})},Re,8,Ue),o("div",je,[Ee,o("ul",Oe,[o("li",null,[o("a",{class:"dropdown-item",onClick:n=>l.cut([s.relativePath])},"剪切",8,Ae)]),o("li",null,[o("a",{class:"dropdown-item",onClick:n=>i.$root.showInput("重命名","输入新文件名",function(){l.rename(s.relativePath)})},"重命名",8,Le)])])])])]))),128)),(a(!0),c(v,null,w(t.files.files,s=>(a(),c("tr",{key:s},[b(o("td",{class:"checkbox",onClick:e[20]||(e[20]=n=>n.target===n.currentTarget&&n.target.querySelector(".form-check-input").click())},[b(o("input",{type:"checkbox",class:"form-check-input",value:s.relativePath,"onUpdate:modelValue":e[19]||(e[19]=n=>t.checkedFiles=n)},null,8,Ve),[[$,t.checkedFiles]])],512),[[D,t.multiSelect]]),o("td",He,[o("i",{class:C(["bi",l.getIcon(s.name,s.fileType)])},null,2),T("  "+g(s.name),1)]),t.columns.includes("size")?(a(),c("td",qe,g(i.$root.formatBytes(s.length)),1)):u("",!0),t.columns.includes("contentType")?(a(),c("td",Je,g(s.fileType),1)):u("",!0),t.columns.includes("lastModified")?(a(),c("td",Ke,g(s.lastModified),1)):u("",!0),o("td",We,[o("a",{class:"link-primary",onClick:n=>l.download(s.relativePath)},Xe,8,Ge),o("a",{class:"link-danger ms-1",onClick:n=>i.$root.showConfirm(function(){l.deleteFile([s.relativePath])})},et,8,Ye),o("div",tt,[st,o("ul",ot,[o("li",null,[s.fileType.includes("image")||s.fileType.includes("text")||s.fileType.includes("video")?(a(),c("a",{key:0,class:"dropdown-item",onClick:n=>l.preview(s.fileType,s.relativePath)},"预览",8,it)):u("",!0)]),o("li",null,[o("a",{class:"dropdown-item",onClick:n=>l.share(s.relativePath)},"分享",8,lt)]),o("li",null,[o("a",{class:"dropdown-item",onClick:n=>l.cut([s.relativePath])},"剪切",8,nt)]),o("li",null,[o("a",{class:"dropdown-item",onClick:n=>i.$root.showInput("重命名","输入新文件名",function(){l.rename(s.relativePath)})},"重命名",8,rt)])])])])]))),128))])])])}const ht=P(U,[["render",ct],["__scopeId","data-v-ac7ac692"]]);export{ht as default};

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <script src="/lib/js/vue.global.js"></script>
    <script src="/lib/js/vue-router.global.min.js"></script>
    <script src="/lib/js/axios.min.js"></script>
    <script src="/lib/js/qs.min.js"></script>
    <script src="/lib/js/bootstrap.bundle.min.js"></script>
    <script src="/lib/js/js.cookie.min.js"></script>
    <script src="/lib/js/clipboard.min.js"></script>
    <link href="/lib/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/lib/css/bootstrap-icons.css" rel="stylesheet" />
    <link href="/css/index.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container">
      <div class="header">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" href="/files.html">文件列表</a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="/p"
              :class="{active: ($route.name == 'pasteList' || $route.name == 'pasteDetail')}"
              >文本共享</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/bookmarks.html">书签列表</a>
          </li>
        </ul>
      </div>

      <router-view></router-view>

      <template id="paste-list">
        <input class="form-control mb-2" placeholder="标题" v-model="title" />
        <textarea
          class="form-control mb-2"
          rows="10"
          placeholder="正文"
          v-model="text"
        ></textarea>
        <button class="btn btn-outline-primary float-end mb-2" @click="add()">
          发布
        </button>

        <ul class="list-group" style="clear: both">
          <li
            class="list-group-item list-group-item-action cursor-pointer"
            v-for="paste in pastes"
            @click="(event) => event.target.tagName !== 'A' && $router.push('/p/' + paste.id)"
          >
            <div class="float-end">
              <a
                class="link-primary bi bi-clipboard"
                id="btn-copy"
                :data-clipboard-text="paste.text"
              ></a>
              <a
                class="link-danger bi bi-trash"
                @click="$root.showConfirm(() => $root.remove(paste.id))"
              >
              </a>
            </div>
            <div>
              <p class="text-primary text-truncate mw-75">{{paste.title}}</p>
              <p class="text-truncate mw-75">{{paste.text}}</p>
              <p class="text-muted mb-0">发布于 {{paste.time.slice(0, -3)}}</p>
            </div>
          </li>
        </ul>
      </template>

      <template id="paste-detail">
        <div class="card">
          <div class="card-body border-bottom" style="padding: 0.781rem 1rem">
            <div
              class="d-flex justify-content-between flex-wrap align-items-center"
            >
              <a class="link-primary" @click="$router.push('/p')">返回</a>
              <div class="text-muted text-truncate paste-detail-title mw-50">
                {{title}}
              </div>
              <div>
                <a
                  class="btn btn-outline-primary btn-sm"
                  id="btn-copy"
                  data-clipboard-target="#textarea"
                  >复制</a
                >
                <a class="btn btn-outline-primary btn-sm" @click="update()"
                  >提交修改</a
                >
                <a
                  class="btn btn-outline-danger btn-sm"
                  @click="$root.showConfirm(() => $root.remove($route.params.id))"
                  >删除</a
                >
              </div>
            </div>
          </div>
          <textarea
            id="textarea"
            class="form-control border-0"
            style="min-height: 75vh"
            v-model="text"
          ></textarea>
        </div>
      </template>

      <template id="share-list">
        <table class="table">
          <tr>
            <th>分享码</th>
            <th>文件路径</th>
            <th>操作</th>
          </tr>
          <tr
            v-for="shareCode in shareCodeList"
            :class="{'text-danger': !shareCode.valid}"
          >
            <td>{{shareCode.code}}</td>
            <td>{{shareCode.path}}</td>
            <td>
              <a
                v-if="shareCode.valid"
                class="link-primary me-1"
                @click="visit(shareCode.code)"
                >访问</a
              >
              <a class="link-danger" @click="remove(shareCode.code)">删除</a>
            </td>
          </tr>
        </table>
      </template>

      <template id="share-detail">
        <div class="card">
          <div class="card-header">文件分享</div>
          <div class="card-body text-center">
            文件名：{{file.name}}<br />
            文件大小：{{file.length}}<br />
            修改时间：{{file.lastModified}}<br />
            文件类型：{{file.fileType}}<br />
            <button
              class="btn btn-sm btn-outline-primary mt-2"
              @click="download(file.relativePath)"
            >
              下载
            </button>
          </div>
        </div>
      </template>
    </div>

    <div class="modal" tabindex="-1" ref="messageModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">{{message.title}}</h5>
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p style="white-space: pre-wrap">{{message.text}}</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-primary" data-bs-dismiss="modal">
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" tabindex="-1" ref="confirmModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">删除</h5>
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>确定要删除吗？</p>
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-outline-danger"
              data-bs-dismiss="modal"
              @click="confirmDelete()"
            >
              确定
            </button>
            <button class="btn btn-outline-primary" data-bs-dismiss="modal">
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" tabindex="-1" ref="authModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">验证</h5>
            <button
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <label for="password" class="form-label">请输入密码</label>
            <input
              type="password"
              class="form-control"
              id="password"
              ref="password"
              @keyup.enter="$refs.btnAuth.click()"
            />
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-outline-primary"
              data-bs-dismiss="modal"
              @click="getToken()"
              ref="btnAuth"
            >
              确定
            </button>
            <button class="btn btn-outline-primary" data-bs-dismiss="modal">
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>
    <div v-show="loading" class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <script src="/js/index.js"></script>
  </body>
</html>

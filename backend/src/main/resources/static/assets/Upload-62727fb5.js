import{_ as b,a as w,c as h,b as t,w as m,g as _,F as y,r as k,n as F,j as d,o as u,t as p,p as D,i as B}from"./index-17d4d99b.js";const C={data(){return{files:[],active:!1}},methods:{addFile(s){this.active=!1,[...s.dataTransfer.items].forEach(i=>{var r=i.webkitGetAsEntry();r&&this.traverseFileTree(r)})},addFromClick(s){Array.from(s.target.files).forEach(i=>{this.files.push(i)})},traverseFileTree(s,e){if(e=e||"",s.isFile)s.file(r=>{this.files.push(r)});else if(s.isDirectory){var i=s.createReader();i.readEntries(r=>{for(var l=0;l<r.length;l++)this.traverseFileTree(r[l],e+s.name+"/")})}},removeFile(s){this.files=this.files.filter(e=>e!=s)},upload(){this.$root.message.title="上传进度";const s=new Modal(this.$root.$refs.progressModal);s.show();const e=new FormData;e.append("currentDirectory","/public/"),this.files.forEach(l=>{e.append("files",l)});var i=new Date().getTime(),r=0;w({method:"post",url:"file/upload",data:e,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:l=>{const a=l.loaded,o=l.total;this.$root.progress=Math.round(a/o*100)+"%";var n=new Date().getTime(),f=a-r,v=(n-i)/1e3,g=v?f/v:0;r=a,i=n,this.$root.speed=this.$root.formatBytes(g)+"/s"}}).then(l=>{l.success?(s.hide(),this.files=[],this.$root.showModal("成功","上传成功"),this.$root.progress=0):(s.hide(),this.$root.showModal("失败",l.msg),this.$root.progress=0)}).catch(l=>{s.hide(),this.$root.showModal("错误",l.message),this.$root.progress=0})}}},c=s=>(D("data-v-ca2a73eb"),s=s(),B(),s),E={class:"drag cursor-pointer",onclick:"document.getElementById('file').value = null; document.getElementById('file').click()"},T=c(()=>t("p",{class:"title"},"未选择文件/文件夹",-1)),$=c(()=>t("p",{class:"subtile"},"支持拖拽到此区域上传，支持选择多个文件/文件夹",-1)),M=[T,$],I={class:"table-wrapper"},x={class:"table table-sm"},S=c(()=>t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"文件名"),t("th",null,"大小"),t("th",null,"操作")])],-1)),P=["onClick"],R=c(()=>t("i",{class:"bi bi-trash"},null,-1)),U=[R],z={class:"text-center"};function A(s,e,i,r,l,a){return u(),h("div",{class:F(["wrapper",{active:l.active}]),onDrop:e[2]||(e[2]=d((...o)=>a.addFile&&a.addFile(...o),["prevent"])),onDragenter:e[3]||(e[3]=d(o=>l.active=!0,["prevent"])),onDragover:e[4]||(e[4]=d(o=>l.active=!0,["prevent"])),onDragleave:e[5]||(e[5]=d(o=>l.active=!1,["prevent"]))},[t("input",{type:"file",name:"file",id:"file",class:"d-none",onChange:e[0]||(e[0]=o=>a.addFromClick(o)),multiple:""},null,32),m(t("div",E,M,512),[[_,l.files.length==0]]),m(t("div",null,[t("div",I,[t("table",x,[S,t("tbody",null,[(u(!0),h(y,null,k(l.files,(o,n)=>(u(),h("tr",{key:n},[t("td",null,p(n+1),1),t("td",null,[t("i",null,p(o.webkitRelativePath?o.webkitRelativePath:o.name),1)]),t("td",null,p(s.$root.formatBytes(o.size)),1),t("td",null,[t("a",{class:"link-danger",onClick:f=>a.removeFile(o)},U,8,P)])]))),128))])])]),t("div",z,[t("button",{class:"btn btn-sm btn-outline-primary mt-2",onClick:e[1]||(e[1]=(...o)=>a.upload&&a.upload(...o))}," 上传文件 ")])],512),[[_,l.files.length!=0]])],34)}const G=b(C,[["render",A],["__scopeId","data-v-ca2a73eb"]]);export{G as default};

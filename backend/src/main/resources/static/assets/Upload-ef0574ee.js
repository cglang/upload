import{_ as w,a as b,c,w as _,g as m,b as e,F as y,r as D,n as F,j as d,o as p,t as u,p as k,i as $}from"./index-25890214.js";const T={data(){return{files:[],active:!1}},methods:{addFile(o){this.active=!1,[...o.dataTransfer.items].forEach(i=>{var a=i.webkitGetAsEntry();a&&this.traverseFileTree(a)})},traverseFileTree(o,t){if(t=t||"",o.isFile)o.file(a=>{this.files.push(a)});else if(o.isDirectory){var i=o.createReader();i.readEntries(a=>{for(var s=0;s<a.length;s++)this.traverseFileTree(a[s],t+o.name+"/")})}},removeFile(o){this.files=this.files.filter(t=>t!=o)},upload(){this.$root.message.title="上传进度";const o=new Modal(this.$root.$refs.progressModal);o.show();const t=new FormData;t.append("currentDirectory","/public/"),this.files.forEach(s=>{t.append("files",s)});var i=new Date().getTime(),a=0;b({method:"post",url:"file/upload",data:t,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{const l=s.loaded,r=s.total;this.$root.progress=Math.round(l/r*100)+"%";var n=new Date().getTime(),v=l-a,f=(n-i)/1e3,g=f?v/f:0;a=l,i=n,this.$root.speed=this.$root.formatBytes(g)+"/s"}}).then(s=>{s.success?(o.hide(),this.files=[],this.$root.showModal("成功","上传成功"),this.$root.progress=0):(o.hide(),this.$root.showModal("失败",s.msg),this.$root.progress=0)}).catch(s=>{o.hide(),this.$root.showModal("错误",s.message),this.$root.progress=0})}}},h=o=>(k("data-v-f29ff6e5"),o=o(),$(),o),M={class:"drag"},B=h(()=>e("p",{class:"title"},"未选择文件/文件夹",-1)),x=h(()=>e("p",{class:"subtile"},"支持拖拽到此区域上传，支持选择多个文件/文件夹",-1)),C=[B,x],E={class:"table-wrapper"},S={class:"table table-sm"},I=h(()=>e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"文件名"),e("th",null,"大小"),e("th",null,"操作")])],-1)),P=["onClick"],R=h(()=>e("i",{class:"bi bi-trash"},null,-1)),U=[R],z={class:"text-center"};function j(o,t,i,a,s,l){return p(),c("div",{class:F(["wrapper",{active:s.active}]),onDrop:t[1]||(t[1]=d((...r)=>l.addFile&&l.addFile(...r),["prevent"])),onDragenter:t[2]||(t[2]=d(r=>s.active=!0,["prevent"])),onDragover:t[3]||(t[3]=d(r=>s.active=!0,["prevent"])),onDragleave:t[4]||(t[4]=d(r=>s.active=!1,["prevent"]))},[_(e("div",M,C,512),[[m,s.files.length==0]]),_(e("div",null,[e("div",E,[e("table",S,[I,e("tbody",null,[(p(!0),c(y,null,D(s.files,(r,n)=>(p(),c("tr",{key:n},[e("td",null,u(n+1),1),e("td",null,[e("i",null,u(r.webkitRelativePath?r.webkitRelativePath:r.name),1)]),e("td",null,u(o.$root.formatBytes(r.size)),1),e("td",null,[e("a",{class:"link-danger",onClick:v=>l.removeFile(r)},U,8,P)])]))),128))])])]),e("div",z,[e("button",{class:"btn btn-sm btn-outline-primary mt-2",onClick:t[0]||(t[0]=(...r)=>l.upload&&l.upload(...r))},"上传文件")])],512),[[m,s.files.length!=0]])],34)}const G=w(T,[["render",j],["__scopeId","data-v-f29ff6e5"]]);export{G as default};

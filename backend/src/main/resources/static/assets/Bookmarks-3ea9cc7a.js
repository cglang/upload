import{_ as $,a,l as d,c as n,b as o,F as p,r as f,w as _,v as b,e as w,o as r,h as k,t as g,p as y,i as v}from"./index-80bae6ae.js";import"./FileSaver.min-0f7e6647.js";const M="/vite.svg";const T={data(){return{bookmarks:{},url:"",tags:"",currentTags:[]}},methods:{isJSON(t){try{return JSON.parse(t)&&!!t}catch(s){return!1}},extractDomain(t){try{const{hostname:s}=new URL(t);return s}catch(s){return null}},list(){if(this.currentTags.length!=0){this.findByTags();return}this.$root.loading=!0,a.post("bookmark/list").then(t=>{t.success?this.bookmarks=t.detail:this.$root.showModal("失败",t.msg)}).catch(t=>{this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.loading=!1})},add(){if(this.url.trim().length===0){this.$root.showModal("提示","URL不能为空");return}this.$root.loading=!0,a.post("bookmark/add",d.stringify({url:this.url})).then(t=>{t.success?(this.list(),this.addTags(t.detail),this.update(t.detail)):this.$root.showModal("添加失败",t.msg)}).catch(t=>{this.$root.showModal("错误",t.message)}).finally(()=>{this.url="",this.$root.loading=!1})},remove(t){this.$root.hasToken(()=>this.remove(t))&&(this.$root.loading=!0,a.post("bookmark/delete",d.stringify({id:t})).then(s=>{s.success?(this.$root.showModal("成功","删除成功"),this.list()):this.$root.showModal("失败","删除失败")}).catch(s=>{this.$root.showModal("错误",s.message)}).finally(()=>{this.$root.loading=!1}))},rename(t){if(this.$root.$refs.input.value.trim().length===0){this.$root.showModal("提示","标题不能为空");return}this.$root.loading=!0,a.post("bookmark/rename",d.stringify({id:t,title:this.$root.$refs.input.value})).then(s=>{s.success?(this.$root.showModal("成功","修改成功"),this.list()):this.$root.showModal("失败","修改失败")}).catch(s=>{this.$root.showModal("错误",s.message)}).finally(()=>{this.$root.loading=!1})},update(t){this.$root.loading=!0,a.post("bookmark/update",d.stringify({id:t})).then(s=>{s.success?(this.$root.showModal("成功","更新成功"),this.list()):this.$root.showModal("失败","更新失败")}).catch(s=>{this.$root.showModal("错误",s.message)}).finally(()=>{this.$root.loading=!1})},addTags(t){this.$root.loading=!0,a.post("bookmark/addTags",d.stringify({bookmarkId:t,tagIds:this.currentTags.join(",")})).then(s=>{s.success||console.log("添加标签失败："+s.msg)}).catch(s=>{console.log("添加标签失败："+s.message)}).finally(()=>{this.$root.loading=!1})},importBookmarks(t){this.$root.loading=!0;var s=new FileReader;s.readAsText(t.target.files[0]),s.onload=u=>{var h=u.target.result;if(!this.isJSON(h)){this.$root.showModal("错误","不是合法的json数据"),this.$root.loading=!1;return}a.post("bookmark/bulkAdd",d.stringify({data:h})).then(l=>{l.success?(this.list(),this.$root.showModal("成功",l.msg)):this.$root.showModal("失败",l.msg)}).catch(l=>{this.$root.showModal("错误",l.message)}).finally(()=>{this.$root.loading=!1})}},exportBookmarks(){this.$root.loading=!0;var t=[];for(const[l,i]of Object.entries(this.bookmarks)){var s=new Object;s.title=i.title,s.url=i.url,t.push(s)}var u=JSON.stringify(t,null,2),h=new Blob([u],{type:"text/plain;charset=utf-8"});saveAs(h,"bookmarks.json"),this.$root.loading=!1},updateAll(){this.$root.loading=!0,a.post("bookmark/updateAll").then(t=>{t.success?(this.list(),this.$root.showModal("成功",t.msg)):this.$root.showModal("失败",t.msg)}).catch(t=>{this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.loading=!1})},listTags(){this.$root.loading=!0,a.post("bookmark/findAllTags").then(t=>{t.success?this.tags=t.detail:this.$root.showModal("失败",t.msg)}).catch(t=>{this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.loading=!1})},findByTags(){if(this.currentTags.length==0){this.list();return}this.$root.loading=!0,a.post("bookmark/findByTags",d.stringify({tagIds:this.currentTags.join(",")})).then(t=>{t.success?this.bookmarks=t.detail:this.$root.showModal("失败",t.msg)}).catch(t=>{this.$root.showModal("错误",t.message)}).finally(()=>{this.$root.loading=!1})}},mounted(){this.list(),this.listTags()}},m=t=>(y("data-v-277ede0b"),t=t(),v(),t),x={class:"mb-2 custom-btn-group"},B=["id","value"],C=["for"],I={class:"input-group mb-2"},S=["disabled"],A=["disabled"],j=["disabled"],O=m(()=>o("i",{class:"bi bi-three-dots-vertical"},null,-1)),N={class:"dropdown-menu"},D=m(()=>o("li",null,[o("a",{class:"dropdown-item",onclick:"document.getElementById('file').value=null; document.getElementById('file').click()"},"导入")],-1)),J={class:"table table-hover table-borderless border shadow-sm"},U={class:"text-truncate",style:{"max-width":"200px"}},V=["src"],E={key:1,class:"icon",src:M},F={key:2,class:"align-middle"},L={key:3,class:"align-middle text-muted"},R={class:"text-truncate url",style:{"max-width":"200px"}},K={class:"text-muted"},q={class:"text-end",style:{width:"10%"}},z={class:"dropdown d-inline"},G=m(()=>o("i",{class:"bi bi-three-dots-vertical link-primary","data-bs-toggle":"dropdown"},null,-1)),H={class:"dropdown-menu"},P=["href"],Q=["data-clipboard-text"],W=m(()=>o("li",null,[o("hr",{class:"dropdown-divider"})],-1)),X=["onClick"],Y=["onClick"],Z=["onClick"];function tt(t,s,u,h,l,i){return r(),n(p,null,[o("input",{type:"file",name:"file",id:"file",class:"d-none",onChange:s[0]||(s[0]=e=>i.importBookmarks(e)),multiple:""},null,32),o("div",x,[(r(!0),n(p,null,f(l.tags,e=>(r(),n("div",{key:e,class:"d-inline"},[_(o("input",{type:"checkbox",class:"btn-check",id:e.id,value:e.id,"onUpdate:modelValue":s[1]||(s[1]=c=>this.currentTags=c),autocomplete:"off",onChange:s[2]||(s[2]=c=>i.findByTags())},null,40,B),[[k,this.currentTags]]),o("label",{class:"btn btn-outline-primary",for:e.id},g(e.title),9,C)]))),128))]),o("div",I,[_(o("input",{class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>l.url=e),onKeyup:s[4]||(s[4]=w(e=>i.add(),["enter"])),disabled:t.$root.loading},null,40,S),[[b,l.url]]),o("button",{class:"btn btn-outline-primary",onClick:s[5]||(s[5]=e=>i.add()),disabled:t.$root.loading}," 添加 ",8,A),o("button",{class:"btn btn-outline-primary","data-bs-toggle":"dropdown",disabled:t.$root.loading},[O,o("ul",N,[D,o("li",null,[o("a",{class:"dropdown-item",onClick:s[6]||(s[6]=e=>i.exportBookmarks())},"导出")]),o("li",null,[o("a",{class:"dropdown-item",onClick:s[7]||(s[7]=e=>i.updateAll())},"更新")])])],8,j)]),o("table",J,[o("tbody",null,[(r(!0),n(p,null,f(l.bookmarks,e=>(r(),n("tr",{key:e},[o("td",U,[e.icon?(r(),n("img",{key:0,class:"icon",src:"data:image/jpeg;base64,"+e.icon},null,8,V)):(r(),n("img",E)),e.title?(r(),n("span",F,g(e.title),1)):(r(),n("span",L,[o("i",null,g(i.extractDomain(e.url)),1)]))]),o("td",R,[o("i",K,g(e.url),1)]),o("td",q,[o("div",z,[G,o("ul",H,[o("li",null,[o("a",{class:"dropdown-item",href:e.url,target:"_blank"},"打开",8,P)]),o("li",null,[o("a",{class:"dropdown-item",id:"btnCopy","data-clipboard-text":e.url},"复制",8,Q)]),W,o("li",null,[o("a",{class:"dropdown-item",onClick:c=>t.$root.showConfirm(()=>i.remove(e.id))},"删除",8,X)]),o("li",null,[o("a",{class:"dropdown-item",onClick:c=>{t.$root.inputValue=e.title,t.$root.showInput("修改标题","输入新标题",function(){i.rename(e.id)})}},"修改",8,Y)]),o("li",null,[o("a",{class:"dropdown-item",onClick:c=>i.update(e.id)},"更新",8,Z)])])])])]))),128))])])],64)}const et=$(T,[["render",tt],["__scopeId","data-v-277ede0b"]]);export{et as default};
